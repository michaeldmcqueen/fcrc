function thwcfeRemoveUploaded(elm,event){thwcfe_public_file_upload.remove_uploaded(elm,event)}function thwcfeChangeUploaded(elm,event){thwcfe_public_file_upload.change_uploaded(elm,event)}var thwcfe_public_file_upload=function($,window,document){"use strict";function setup_file_upload(wrapper,data){wrapper.find(".thwcfe-checkout-file").on("change",upload_file)}function upload_file(event){var files=event.target.files,wrapper=($("#"+event.target.id).parent(),$(this).closest(".thwcfe-input-field-wrapper")),input=wrapper.find(".thwcfe-checkout-file-value"),field_name=input.attr("name"),data=new FormData;data.append("action","thwcfe_file_upload"),data.append("field_name",field_name),$.each(files,function(key,value){data.append("file",value)}),$.ajax({type:"POST",url:thwcfe_public_var.ajax_url,data:data,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){wrapper.find(".thwcfe-file-upload-status").show(),input.val(""),clear_message(wrapper)}}).done(function(data,textStatus,jqXHR){if("SUCCESS"==data.response){var uploaded=data.uploaded;if(uploaded){var filenames_arr=[],filenames="";$(uploaded).each(function(index,uploaded_item){var item_name=uploaded_item.name;item_name&&-1==$.inArray(item_name,filenames_arr)&&filenames_arr.push(item_name)}),filenames_arr.length&&(filenames=filenames_arr.toString()),input.val(JSON.stringify(uploaded)),input.data("file-name",filenames);var remove_btn=wrapper.find(".thwcfe-remove-uploaded");remove_btn.data("file",uploaded.file),remove_btn.show();var prev_html=prepare_preview_html(uploaded);wrapper.find(".thwcfe-upload-preview").html(prev_html),wrapper.find(".thwcfe-uloaded-files").show(),wrapper.find(".thwcfe-checkout-file").hide(),input.trigger("change")}}else add_message(wrapper,data,"error"),clean_file_input(wrapper)}).fail(function(jqXHR,textStatus,error){add_message(wrapper,data,"error"),clean_file_input(wrapper)}).always(function(){wrapper.find(".thwcfe-file-upload-status").hide()})}function prepare_preview_html(uploaded){var file_size="";$.isNumeric(uploaded.size)&&(file_size=uploaded.size/1e3,file_size=Math.round(file_size),file_size+=" KB");var prev_html='<span class="thwcfe-uloaded-file-list"><span class="thwcfe-uloaded-file-list-item">';return prev_html+='<span class="thwcfe-columns">',-1!==$.inArray(uploaded.type,IMG_FILE_TYPES)&&(prev_html+='<span class="thwcfe-column-thumbnail">',prev_html+='<img src="'+uploaded.url+'" >',prev_html+="</span>"),prev_html+='<span class="thwcfe-column-title">',prev_html+='<span title="'+uploaded.name+'" class="title">'+uploaded.name+"</span>",file_size&&(prev_html+='<span class="size">'+file_size+"</span>"),prev_html+="</span>",prev_html+='<span class="thwcfe-column-actions">',prev_html+='<a href="#" onclick="thwcfeRemoveUploaded(this, event); return false;" class="thwcfe-action-btn thwcfe-remove-uploaded" title="Remove">X</a>',prev_html+="</span>",prev_html+="</span>",prev_html+="</span></span>"}function remove_uploaded(elm,event){var wrapper=$(elm).closest(".thwcfe-input-field-wrapper"),file=$(elm).data("file"),data={action:"thwcfe_remove_uploaded",file:file};$.ajax({type:"POST",url:thwcfe_public_var.ajax_url,data:data,cache:!1,dataType:"json",beforeSend:function(){wrapper.find(".thwcfe-uloaded-files").hide(),wrapper.find(".thwcfe-file-upload-status").show(),clear_message(wrapper)}}).done(function(data,textStatus,jqXHR){"SUCCESS"==data.response?($(elm).data("file",""),$(elm).hide(),wrapper.find(".thwcfe-upload-preview").html(""),wrapper.find(".thwcfe-uloaded-files").hide(),wrapper.find(".thwcfe-checkout-file").show(),clean_file_input(wrapper),add_message(wrapper,data,"success")):"ERROR"==data.response&&add_message(wrapper,data,"error")}).fail(function(jqXHR,textStatus,error){wrapper.find(".thwcfe-uloaded-files").show(),add_message(wrapper,error,"error")}).always(function(){wrapper.find(".thwcfe-file-upload-status").hide()})}function change_uploaded(elm,event){var wrapper=$(elm).closest(".thwcfe-input-field-wrapper");wrapper.find(".thwcfe-remove-uploaded").hide(),wrapper.find(".thwcfe-input-file").show()}function clean_file_input(wrapper){var input=wrapper.find(".thwcfe-checkout-file-value");wrapper.find(".thwcfe-checkout-file").val(""),input.val(""),input.data("file-name",""),input.trigger("change")}function add_message(wrapper,data,type){data.response&&data.error?(wrapper.find(".thwcfe-file-upload-msg").html(data.error),wrapper.find(".thwcfe-file-upload-msg").show()):clear_message(wrapper)}function clear_message(wrapper){wrapper.find(".thwcfe-file-upload-msg").html(""),wrapper.find(".thwcfe-file-upload-msg").hide()}var IMG_FILE_TYPES=["image/jpg","image/png","image/gif","image/jpeg"];return{setup_file_upload:setup_file_upload,remove_uploaded:remove_uploaded,change_uploaded:change_uploaded,prepare_preview_html:prepare_preview_html,clean_file_input:clean_file_input}}(window.jQuery,window,document),thwcfe_user_profile=function($){"use strict";function initialize_thwcfe_userprofile(){var form_wrapper=$("#your-profile");form_wrapper&&thwcfe_public_file_upload.setup_file_upload(form_wrapper,thwcfe_public_var)}return initialize_thwcfe_userprofile(),{initialize_thwcfe_userprofile:initialize_thwcfe_userprofile}}(jQuery);